<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
	<!-- Load Esri Leaflet from CDN -->
	<script src="https://unpkg.com/esri-leaflet@2.4.1/dist/esri-leaflet.js" integrity="sha512-xY2smLIHKirD03vHKDJ2u4pqeHA7OQZZ27EjtqmuhDguxiUvdsOuXMwkg16PQrm9cgTmXtoxA6kwr8KBy3cdcw==" crossorigin=""></script>

	<!-- Load Esri Leaflet Geocoder from CDN -->
	<link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.3.3/dist/esri-leaflet-geocoder.css" integrity="sha512-IM3Hs+feyi40yZhDH6kV8vQMg4Fh20s9OzInIIAc4nx7aMYMfo+IenRUekoYsHZqGkREUgx0VvlEsgm7nCDW9g==" crossorigin="">
	<script src="https://unpkg.com/esri-leaflet-geocoder@2.3.3/dist/esri-leaflet-geocoder.js" integrity="sha512-HrFUyCEtIpxZloTgEKKMq4RFYhxjJkCiF5sDxuAokklOeZ68U2NPfh4MFtyIVWlsKtVbK5GD2/JzFyAfvT5ejA==" crossorigin=""></script>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<meta charset="utf-8">
	<title>Valais Invaders</title>
</head>

<body>

	<div id="startMenu" hidden>
		<div id="home">
			<h1 id="gameTitle">Valais Invaders</h1>
			<div><input type="text" id="playerName" placeholder="T'es le fils à qui ? (Pseudo)"></input></div>

			<div class="btn-group">
				<button class='button' id="chooseHeroButton" disabled>Adjeu, on démarre ou bien !</button>
				<button class='button' id="infosButton">Euille, tu veux voir comment ?</button>
			</div>
		</div>
		<div id="chooseHero" style="height: 100%" hidden>
			<div id="chooseHeroTitle">
				<h2 id="chooseHeroTextTitle">Choisis voir ta légende Valaisanne</h2>
			</div>
			<table style="width:100%">
				<tr>
					<td class="heroOption">
						<h3>Christian Constantin</h3>
						<img class="hero" id="constantin" src="img/bus-FCSION.png" draggable="true" ondragstart="drag(event)" />
					</td>
					<td class="heroOption">
						<h3>Oskar Freysinger</h3>
						<img class="hero" id="freysinger" src="img/subaru.png" draggable="true" ondragstart="drag(event)" />
					</td>
					<td class="heroOption">
						<h3>Bernard Rappaz</h3>
						<img class="hero" id="rappaz" src="img/bus-HIPPIE.png" draggable="true" ondragstart="drag(event)" />
					</td>
				</tr>
				<tr>
					<td colspan="3" style="text-align: center">
						<div id="dropColumn">
							<div id="dropSpot" ondrop="drop(event)" ondragover="allowDrop(event)">
								<p id="dropHint">Ecoute voir, t'as juste à glisser la bagnole que tu veux ençà</p>
							</div>
						</div>

					</td>
				</tr>
				<tr>
					<td>
						<button class='button' id="backButton">Retour</button>
					</td>
					<td></td>
					<td>
						<div id="startGeolocationButtonZone">
							<button class='button' id="startGeolocationButton" disabled>T'as où les vaches ?</button>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<div id="geolocationTest" style="height: 100%" hidden>
			<h2>Le "T'as où les vaches ?" Test</h2>
			<div class="loader" id="geolocLoader"></div>
			<div id="mapid"></div>
			<h3 id="resultMessage"></h3>
			<button class='button' id="startGameButton">On part en piste ou quoi ?</button>

		</div>
		<div id="infosScreen" hidden>
			<h2 id="infosTitle">Tu veux voir comment ?</h2>
			<table id="infosTable" style="height: 450px;">
				<tr>
					<td style="width: 50%;">
						<h3>Nos terres sont plus que jamais menacées. Des envahisseurs vaudois essaient de s'approprier notre magnifique patrimoine Valaisan. Il est de ton ressort des les en empêcher. Pour se faire, tu devras choisir un héro parmis nos trois légendes : Christian Constantin, Oskar Freysinger et Bernard Rappaz.</h3>
						<div id="controlKeys">
							<div id=firstline>
								<div class="controlKey" id="wKey">
									<p>W</p>
								</div>
							</div>
							<div id="secondline">
								<div class="controlKey" id="aKey">
									<p>A</p>
								</div>
								<div class="controlKey" id="sKey">
									<p>S</p>
								</div>
								<div class="controlKey" id="dKey">
									<p>D</p>
								</div>
							</div>
						</div>

					</td>
					<td style="width: 50%;">
						<h3>Attention, tu devras éviter les tonneaux de "vin" vaudois. Pour te donner des points et de la force, tu pourras ramasser les bouteilles de Fendant, les fromages et les abricots.</h3>
					</td>
				</tr>
			</table>
			<button class='button' id="infosBackButton">Retour</button>
		</div>
	</div>

	<div id="gameZone" hidden>
		<canvas id="canvas" width="1500" height="670">

		</canvas>
		<img id="fond" src="img/back.png">

	</div>
	<div id="gameover" hidden>
		<h1>Valais Invaders</h1>
		<h2>C'est perdu ...</h2>
		<p id="1"></p>
		<p id="2"></p>
		<p id="3" style="font-size: 50px"></p>
		<footer>
			<button type="rejouer" onclick="javascript:window.location.reload()">On y retourne ou bien ?</button>
		</footer>
	</div>

	<div id="win" hidden>
		<h1>Valais Invaders</h1>
		<h2>Bien joué mon gars ! L'ennemi est vaincu !</h2>
		<p id="4"></p>
		<p id="5"></p>
		<p id="6" style="font-size: 50px"></p>
		<footer>
			<button type="rejouer" onclick="javascript:window.location.reload()">On y retourne ou bien ?</button>
		</footer>
	</div>

</body>

<script src="javascript/entities.js"></script>
<script src="javascript/game.js"></script>
<script src="javascript/geolocation.js"></script>
<!--<script src="javascript/score.js"></script>-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" />
</script>

</html>

<script>
	var playerName;
	var heroChoosedId;
	var time;
	//Managing different screens before game starts
	$(document).ready(function() {

		var chooseHeroElement;
		var geolocationTestElement;
		var gameZoneElement;
		var homeElement;
		var infosScreenElement;

		$("#playerName").on("keyup", function() {
			if ($(this).val().length != 0) {
				$("#chooseHeroButton").removeAttr("disabled");
			} else {
				$("#chooseHeroButton").prop('disabled', true);
			}

		});
		$("#chooseHeroButton").click(function() {
			//Save the player name
			playerName = $("#playerName").val();
			//Remove home screen and display choose hero screen
			homeElement = $("#home").detach();
			$("#startMenu").prepend(chooseHeroElement);
			$("#chooseHeroTextTitle").text("Choisis voir ta légende Valaisanne, " + playerName + " !");
			$("#chooseHero").removeAttr("hidden");
		});
		$("#infosButton").click(function() {
			//Remove home screen and display infos screen
			homeElement = $("#home").detach();
			$("#startMenu").prepend(infosScreenElement);
			$("#infosScreen").removeAttr("hidden");
		});
		$("#infosBackButton").click(function() {
			//Return to start screen
			infosScreenElement = $("#infosScreen").detach();
			homeElement.appendTo("#startMenu");
		});

		$("#backButton").click(function() {
			//Reset of the screen when back is clicked
			const dropSpot = document.getElementById("dropSpot");
			dropSpot.textContent = "";
			$("#dropSpot").append('<p id="dropHint">Ecoute voir, t\'as juste à glisser la bagnole que tu veux encà</p>');
			$("#startGeolocationButton").prop('disabled', true);

			//Return to start screen
			chooseHeroElement = $("#chooseHero").detach();
			homeElement.appendTo("#startMenu");
		});
		$("#startGeolocationButton").click(function() {
			//Remove choose hero screen and display geolocation test screen
			chooseHeroElement = $("#chooseHero").detach();
			$("#startMenu").prepend(geolocationTestElement);
			$("#geolocationTest").removeAttr("hidden");
			findLocation();
		});
		$("#startGameButton").click(function() {
			//prepareGame();
			//Remove start menu
			$("#startMenu").remove();


			if (heroChoosedId === "") {
				location.reload();
				return;
			}

			//Start game

			$("body").prepend(gameZoneElement); //display game zone
			$("#gameZone").removeAttr("hidden");

			player = Player();
			startNewGame();

			ctx.drawImage(Img.bg, 0, 0);

			drawMap = function() {

				ctx.drawImage(Img.bg, 0, 0);

			}


		});

		//Remove after defining back button
		chooseHeroElement = $("#chooseHero").detach();
		geolocationTestElement = $("#geolocationTest").detach();
		gameZoneElement = $("#gameZone").detach();
		infosScreenElement = $("#infosScreen").detach();
		$("#startMenu").removeAttr("hidden");


	});

	//Drag and Drop
	function allowDrop(ev) {
		ev.preventDefault();
	}

	function drag(ev) {
		ev.dataTransfer.setData("text", ev.target.id);
		const dropSpot = document.getElementById("dropSpot");
		dropSpot.textContent = "";
	}


	function drop(ev) {
		ev.preventDefault();
		var data = ev.dataTransfer.getData("text");
		var nodeCopy = document.getElementById(data).cloneNode(true);
		nodeCopy.id = data + "1";
		nodeCopy.draggable = false;
		ev.target.appendChild(nodeCopy);
		heroChoosedId = $("#dropSpot").children("img").attr("id");
		//Register hero choosed
		switch (heroChoosedId) {
			case "constantin1":
				heroChoosedId = "constantin";
				break;
			case "freysinger1":
				heroChoosedId = "freysinger";
				break;
			case "rappaz1":
				heroChoosedId = "rappaz";
				break;
			default:
				heroChoosedId = "";
		}

		$("#startGeolocationButton").removeAttr('disabled');
	}

	//Location

</script>
